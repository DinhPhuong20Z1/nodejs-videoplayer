<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>VideoPhone</title>
    <script src="/socket.io/socket.io.js"></script>
  </head>

  <body>
    <h1>VideoPhone</h1>

    <video id="videoPlayer" width="650" controls onseeking="myFunction()">
      <source src="/video" type="video/mp4" />
    </video>

    <script>
      var socket = io();

      


      socket.on("ClickPlayTv", (data) => {
        // console.log("data", data);
        let myVideo2 = document.getElementById("videoPlayer");

        // myVideo2.currentTime = data.currentTime;
        myVideo2.muted = data.muted;
        myVideo2.volume = data.volume;
        fmData = data.paused;
        
        if (!data.paused) {
          // myVideo2.currentTime = data.currentTime;
          myVideo2.play();
        } else {
          // myVideo2.currentTime = data.currentTime;
          myVideo2.pause();
        }
        // myVideo2.play();
      });
      // socket.on("ClickPlayTv", (data) => {
      //   console.log('data',data);
      // });

      socket.emit("changePhone");

      let a = true;
      var b = 1;
      var c = 2;
      // function resolveAfter2Seconds() {
          
       
        socket.on("ClickSeekTv", (data) => {
          console.log('data',data);
          a = false;
          b = Math.random();
          console.log('aaaaa',a);
          let myVideo2 = document.getElementById("videoPlayer");
          myVideo2.currentTime = data;
        });
      // }
      // resolveAfter2Seconds();

      

      window.addEventListener(
        "load",
        function () {
          var myVideo = document.getElementById("videoPlayer");
          
          myVideo.addEventListener(
            "timeupdate",
            function () {
              let data = {};
              checkPhone = true;
              socket.on("CheckPlayPhone", (checkTv) => {
                checkPhone = false;
                if (checkTv) {
                  data = {
                    paused: myVideo.paused,
                    // currentTime: myVideo.currentTime,
                    muted: myVideo.muted,
                    volume: myVideo.volume,
                  };
                  socket.emit("ClickPlayPhone", data);
                }
              });

              const checkP = () => {
                if (checkPhone) {
                  data = {
                    paused: myVideo.paused,
                    // currentTime: myVideo.currentTime,
                    muted: myVideo.muted,
                    volume: myVideo.volume,
                  };
                  socket.emit("ClickPlayPhone", data);
                }
              };

              setTimeout(checkP, 0);

            },
            false
          );
          // myVideo.onseeking = (event) => {
          //   let data = myVideo.currentTime;
          //   socket.emit("ClickSeekPhone", data);

          // };
        },
        false
      );

      


      async function myFunction() {
        
        console.log('calling',a);
        console.log('calling', b);
        console.log('calling', c);
        // const result = await resolveAfter2Seconds();
        // console.log(result);
        // setTimeout(() => {
          if(a) {
            let myVideo = document.getElementById("videoPlayer");
            let data = myVideo.currentTime;
          socket.emit("ClickSeekPhone", data);
          }
          let bc =  b - c ;
          if(a == false && bc === 0 ) {
            console.log('da vao');
            let myVideo = document.getElementById("videoPlayer");
            let data = myVideo.currentTime;
          socket.emit("ClickSeekPhone", data);
          }
          c = b;
        // }, 0);
        
       
      }
      
    </script>
  </body>
</html>
